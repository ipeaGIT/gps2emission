<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring Emission Factors • gtfs2emis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Exploring Emission Factors">
<meta property="og:description" content="gtfs2emis">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gtfs2emis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gtfs2emis_emission_factor.html">Exploring Emission Factors</a>
    </li>
    <li>
      <a href="../articles/gtfs2emis_fleet_data.html">Preparing fleet data for gtfs2emis</a>
    </li>
    <li>
      <a href="../articles/gtfs2emis_intro_vignette.html">Getting started</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipeaGIT/gtfs2emis/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="gtfs2emis_emission_factor_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Exploring Emission Factors</h1>
            
            <h4 data-toc-skip class="date">2022-11-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/gtfs2emis/blob/HEAD/vignettes/gtfs2emis_emission_factor.Rmd" class="external-link"><code>vignettes/gtfs2emis_emission_factor.Rmd</code></a></small>
      <div class="hidden name"><code>gtfs2emis_emission_factor.Rmd</code></div>

    </div>

    
    
<p>Emission factor models tell us the mass of pollutants that are expected to be emitted by a given vehicle given a few characteristics such as vehicle age, type, fuel, technology, speed, and distance traveled. Various environmental agencies develop these functional relations based on data collected from local measurements. Understanding how emission factor data work is very important to understand how the emission estimates of a given vehicle or public transport system are influenced by the methodological choices of which emission factor model should be used. This vignette helps users explore the emission factors data available in the <code>gtfs2emis</code> package.</p>
<div class="section level2">
<h2 id="available-emission-factor-models">Available emission factor models<a class="anchor" aria-label="anchor" href="#available-emission-factor-models"></a>
</h2>
<p>The <code>gtfs2emis</code> package currently includes emission factor data from four environmental agencies. Reports with detailed information and methos on how these emission factor data were originally calculated can be found on the agencies’ websites in the links below</p>
<ul>
<li>Brazil, Environment Company of São Paulo — <a href="https://cetesb.sp.gov.br/veicular/" class="external-link">CETESB</a>
</li>
<li>United States, Environmental Protection Agency — <a href="https://www.epa.gov/moves" class="external-link">MOVES3 Model</a>
</li>
<li>United States, California Air Resources Board — <a href="https://arb.ca.gov/emfac/emissions-inventory" class="external-link">EMFAC2017 model</a>
</li>
<li>Europe, European Environment Agency — <a href="https://www.eea.europa.eu//publications/emep-eea-guidebook-2019" class="external-link">EMEP-EEA</a>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="visualizing-emission-factor-data">Visualizing emission factor data<a class="anchor" aria-label="anchor" href="#visualizing-emission-factor-data"></a>
</h2>
<p>Emission fator values vary by fleet characteristics — as shown in <a href="https://ipeagit.github.io/gtfs2emis/articles/gtfs2emis_fleet_data.html" class="external-link">Defining Fleet data vignette</a>. In this section we will use the <code><a href="../reference/ef_europe_emep.html">ef_europe_emep()</a></code> function and look at three types of urban buses (Midi, Standard and Articulated) to illustrate how emissions vary according to vehicle type, average speed, and pollutant.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/gtfs2emis/" class="external-link">gtfs2emis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-quantities/units/" class="external-link">units</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; udunits database from /usr/share/xml/udunits/udunits2.xml</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">ef_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_europe_emep.html">ef_europe_emep</a></span><span class="op">(</span>speed <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>,<span class="st">"km/h"</span><span class="op">)</span></span>
<span>                            ,veh_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ubus Midi &lt;=15 t"</span></span>
<span>                                          ,<span class="st">"Ubus Std 15 - 18 t"</span></span>
<span>                                          ,<span class="st">"Ubus Artic &gt;18 t"</span><span class="op">)</span></span>
<span>                            ,euro <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"III"</span>, <span class="st">"IV"</span>, <span class="st">"V"</span><span class="op">)</span></span>
<span>                            ,pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PM10"</span>, <span class="st">"NOx"</span><span class="op">)</span></span>
<span>                            ,fuel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"D"</span>, <span class="st">"D"</span><span class="op">)</span></span>
<span>                            ,tech <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">"SCR"</span>, <span class="st">"SCR"</span><span class="op">)</span></span>
<span>                            ,as_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ef_europe</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "pollutant" "veh_type"  "euro"      "fuel"      "tech"      "slope"    </span></span>
<span><span class="co">#&gt; [7] "load"      "speed"     "EF"</span></span></code></pre></div>
<p>In the case above, the function returns a <code>list</code> that contains all the relevant information for the emission factor — shown in <code>names(ef_europe)</code>. However, it may be useful to check the emission factor results in a <code>data.frame</code> or graphic format.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ef_europe_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emis_to_dt.html">emis_to_dt</a></span><span class="op">(</span>emi_list <span class="op">=</span> <span class="va">ef_europe</span></span>
<span>                           ,emi_vars <span class="op">=</span> <span class="st">"EF"</span></span>
<span>                           ,veh_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"veh_type"</span>,<span class="st">"euro"</span>,<span class="st">"fuel"</span>,<span class="st">"tech"</span><span class="op">)</span></span>
<span>                           ,pol_vars <span class="op">=</span> <span class="st">"pollutant"</span></span>
<span>                           ,segment_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"slope"</span>,<span class="st">"load"</span>,<span class="st">"speed"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ef_europe_dt</span><span class="op">)</span></span>
<span><span class="co">#&gt;            veh_type euro fuel tech pollutant               EF slope load speed</span></span>
<span><span class="co">#&gt; 1: Ubus Midi &lt;=15 t  III    D    -      PM10 0.2559070 [g/km]     0  0.5    10</span></span>
<span><span class="co">#&gt; 2: Ubus Midi &lt;=15 t  III    D    -      PM10 0.2559070 [g/km]     0  0.5    11</span></span>
<span><span class="co">#&gt; 3: Ubus Midi &lt;=15 t  III    D    -      PM10 0.2413421 [g/km]     0  0.5    12</span></span>
<span><span class="co">#&gt; 4: Ubus Midi &lt;=15 t  III    D    -      PM10 0.2285624 [g/km]     0  0.5    13</span></span>
<span><span class="co">#&gt; 5: Ubus Midi &lt;=15 t  III    D    -      PM10 0.2172637 [g/km]     0  0.5    14</span></span>
<span><span class="co">#&gt; 6: Ubus Midi &lt;=15 t  III    D    -      PM10 0.2072074 [g/km]     0  0.5    15</span></span>
<span><span class="co">#&gt;    segment_id</span></span>
<span><span class="co">#&gt; 1:          1</span></span>
<span><span class="co">#&gt; 2:          2</span></span>
<span><span class="co">#&gt; 3:          3</span></span>
<span><span class="co">#&gt; 4:          4</span></span>
<span><span class="co">#&gt; 5:          5</span></span>
<span><span class="co">#&gt; 6:          6</span></span></code></pre></div>
<p>Plotting the speed-dependent emission factors according to vehicle type (<code>veh_type</code>) and euro standard (<code>euro</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ef_europe_dt</span><span class="op">$</span><span class="va">name_fleet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">ef_europe_dt</span><span class="op">$</span><span class="va">veh_type</span>, <span class="st">"/ Euro"</span></span>
<span>                                 , <span class="va">ef_europe_dt</span><span class="op">$</span><span class="va">euro</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ef_europe_dt</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span>,y <span class="op">=</span> <span class="va">EF</span>,color <span class="op">=</span> <span class="va">name_fleet</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Category / EURO"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">pollutant</span>,scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gtfs2emis_emission_factor_files/figure-html/unnamed-chunk-4-1.png" width="672"><!--  666 Achei esse paragrafo confuso --> In a few situations in <code><a href="../reference/ef_europe_emep.html">ef_europe_emep()</a></code>, when the information on vehicle technology does not match the existing database, the package displays a message indicating the technology considered. Users can either select existing data for the combining variables (<code>euro</code>, <code>tech</code>, <code>veh_type</code>, and <code>pollutant</code>), or accept the assumed change in vehicle technology.</p>
<!--  666 nao ficou indicado no texto o q esse codigo abaixo faz -->
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ef_europe_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_europe_emep.html">ef_europe_emep</a></span><span class="op">(</span>speed <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>,<span class="st">"km/h"</span><span class="op">)</span></span>
<span>                                ,veh_type <span class="op">=</span> <span class="st">"Ubus Std 15 - 18 t"</span></span>
<span>                                ,euro <span class="op">=</span> <span class="st">"VI"</span>,pollutant <span class="op">=</span> <span class="st">"CO2"</span></span>
<span>                                ,tech <span class="op">=</span> <span class="st">"DPF+SCR"</span></span>
<span>                                ,as_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'CO2' Emission factor not found for 'DPF+SCR' Technology and Euro 'VI'.</span></span>
<span><span class="co">#&gt;  The package assumed 'SCR' Technology entry. Please check `data(ef_europe_emep_db)` for available data.</span></span></code></pre></div>
<p>The other EF functions, <code><a href="../reference/ef_usa_emfac.html">ef_usa_emfac()</a></code>, <code><a href="../reference/ef_usa_moves.html">ef_usa_moves()</a></code> and <code><a href="../reference/ef_brazil_cetesb.html">ef_brazil_cetesb()</a></code> work in a similar way. See the functions documentation for more detail.</p>
<!-- ```{r} -->
<!-- ef_usa_moves_list <- ef_usa_moves(pollutant = "CO2" -->
<!--                                   ,model_year = 2018 -->
<!--                                   ,reference_year = 2019 -->
<!--                                   ,speed = units::set_units(20,"km/h") -->
<!--                                   ,fuel = "D") -->
<!-- ef_usa_emfac_list <- ef_usa_emfac(pollutant = "CO2" -->
<!--                                   ,model_year = 2018 -->
<!--                                   ,reference_year = 2019 -->
<!--                                   ,speed = units::set_units(20,"km/h") -->
<!--                                   ,fuel = "D") -->
<!-- ef_brazil_list <- ef_brazil_cetesb(pollutant = "CO2" -->
<!--                                    ,veh_type = "BUS_URBAN_D" -->
<!--                                    ,model_year = 2018) -->
<!-- ``` -->
<div class="section level3">
<h3 id="scaling-emission-factors-making-emission-facotrs-speed-dependent">Scaling Emission Factors: making emission facotrs speed-dependent<a class="anchor" aria-label="anchor" href="#scaling-emission-factors-making-emission-facotrs-speed-dependent"></a>
</h3>
<p>For most models (MOVES3, EMEP-EEA and EMFAC2017), emission factors depend on a vehicle’s speed. However, the emission factors developed for Brazil by CETESB (<code><a href="../reference/ef_brazil_cetesb.html">ef_brazil_cetesb()</a></code>) do not vary by vehicle speed. In such a case, users can “scale” or adjust the local emission factor values to make them speed-dependent using the function <code><a href="../reference/ef_scaled_euro.html">ef_scaled_euro()</a></code>.</p>
<p>When using the EMEP-EEA model as a reference, the scaled emission factor varies according to vehicle’s speed following the expression:</p>
<p><span class="math display">\[
EF_{scaled} (V) = EF_{local} * \frac{EF_{euro}(V)}{EF_{euro}(SDC)}, 
\]</span> where <span class="math inline">\(EF_{scaled}(V)\)</span> is the scaled emission factor for each street link, <span class="math inline">\(EF_{local}\)</span> is the local emission factor, <span class="math inline">\(EF_{euro}(V)\)</span> and <span class="math inline">\(EF_{euro}(SDC)\)</span> are the EMEP/EEA emission factor the speed of V and the average urban driving speed SDC, respectively.</p>
<p>The scaled behavior of EF can be verified graphically when we plot the <span class="math inline">\(EF_{local}\)</span>, <span class="math inline">\(EF_{scaled}(V)\)</span>, and the <span class="math inline">\(EF_{euro}(V)\)</span> that is used as the reference To plot these data, we need six quick steps:</p>
<ol style="list-style-type: decimal">
<li>Build a <code>data.frame</code> of fleet indicating the correspondence between the fleet characteristic in the local and European emission models</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fleet_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/bra_cur_fleet.txt"</span>, package <span class="op">=</span> <span class="st">"gtfs2emis"</span><span class="op">)</span></span>
<span><span class="va">cur_fleet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fleet_filepath</span>,header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">","</span>, nrows <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cur_fleet</span></span>
<span><span class="co">#&gt;   year euro shape_id type_name_br           veh_type total fuel</span></span>
<span><span class="co">#&gt; 1 2006  III     1849  BUS_URBAN_D Ubus Std 15 - 18 t     2    D</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Estimate local emission factors</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cur_local_ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_brazil_cetesb.html">ef_brazil_cetesb</a></span><span class="op">(</span>pollutant <span class="op">=</span> <span class="st">"CO2"</span></span>
<span>                                 ,veh_type <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">type_name_br</span></span>
<span>                                 ,model_year <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cur_local_ef</span><span class="op">)</span></span>
<span><span class="co">#&gt; $pollutant</span></span>
<span><span class="co">#&gt; [1] "CO2"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $veh_type</span></span>
<span><span class="co">#&gt; [1] "BUS_URBAN_D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $model_year</span></span>
<span><span class="co">#&gt; [1] 2006</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $EF</span></span>
<span><span class="co">#&gt; Units: [g/km]</span></span>
<span><span class="co">#&gt;      CO2_2006</span></span>
<span><span class="co">#&gt; [1,] 1385.626</span></span>
<span></span>
<span><span class="co"># convert Local EF to data.frame</span></span>
<span><span class="va">cur_local_ef_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emis_to_dt.html">emis_to_dt</a></span><span class="op">(</span>emi_list <span class="op">=</span> <span class="va">cur_local_ef</span></span>
<span>                             ,emi_vars <span class="op">=</span> <span class="st">"EF"</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Estimate <code>ef_emep_europe</code>
</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Euro EF</span></span>
<span><span class="va">cur_euro_ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_europe_emep.html">ef_europe_emep</a></span><span class="op">(</span>speed <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>,<span class="st">"km/h"</span><span class="op">)</span></span>
<span>                              ,veh_type <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">veh_type</span></span>
<span>                              ,euro <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">euro</span></span>
<span>                              ,pollutant <span class="op">=</span> <span class="st">"CO2"</span></span>
<span>                              ,tech <span class="op">=</span> <span class="st">"-"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to data.frame</span></span>
<span><span class="va">cur_euro_ef_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emis_to_dt.html">emis_to_dt</a></span><span class="op">(</span>emi_list <span class="op">=</span> <span class="va">cur_euro_ef</span></span>
<span>                             ,emi_vars <span class="op">=</span> <span class="st">"EF"</span></span>
<span>                             ,veh_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"veh_type"</span>,<span class="st">"euro"</span>,<span class="st">"fuel"</span>,<span class="st">"tech"</span><span class="op">)</span></span>
<span>                             ,segment_vars <span class="op">=</span> <span class="st">"speed"</span><span class="op">)</span></span>
<span><span class="va">cur_euro_ef_dt</span><span class="op">$</span><span class="va">source</span> <span class="op">&lt;-</span> <span class="st">"Euro EF"</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Apply <code><a href="../reference/ef_scaled_euro.html">ef_scaled_euro()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cur_scaled_ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_scaled_euro.html">ef_scaled_euro</a></span><span class="op">(</span>ef_local <span class="op">=</span> <span class="va">cur_local_ef</span><span class="op">$</span><span class="va">EF</span></span>
<span>                                ,speed <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>,<span class="st">"km/h"</span><span class="op">)</span></span>
<span>                                ,veh_type <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">veh_type</span></span>
<span>                                ,euro <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">euro</span></span>
<span>                                ,pollutant <span class="op">=</span> <span class="st">"CO2"</span></span>
<span>                                ,tech <span class="op">=</span> <span class="st">"-"</span></span>
<span>                                <span class="op">)</span></span>
<span><span class="co"># convert to data.frame</span></span>
<span><span class="va">cur_scaled_ef_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emis_to_dt.html">emis_to_dt</a></span><span class="op">(</span>emi_list <span class="op">=</span> <span class="va">cur_scaled_ef</span></span>
<span>                               ,emi_vars <span class="op">=</span> <span class="st">"EF"</span></span>
<span>                               ,veh_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"veh_type"</span>,<span class="st">"euro"</span>,<span class="st">"fuel"</span>,<span class="st">"tech"</span><span class="op">)</span></span>
<span>                               ,segment_vars <span class="op">=</span> <span class="st">"speed"</span><span class="op">)</span></span>
<span><span class="va">cur_scaled_ef_dt</span><span class="op">$</span><span class="va">source</span> <span class="op">&lt;-</span> <span class="st">"Scaled EF"</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>View in ggplot2</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rbind data</span></span>
<span><span class="va">cur_ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cur_euro_ef_dt</span>, <span class="va">cur_scaled_ef_dt</span><span class="op">)</span></span>
<span><span class="va">cur_ef</span><span class="op">$</span><span class="va">source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cur_ef</span><span class="op">$</span><span class="va">source</span></span>
<span>                        ,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Scaled EF"</span>, <span class="st">"Euro EF"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># add scaled and euro EF</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cur_ef</span></span>
<span>            ,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span>,y <span class="op">=</span> <span class="va">EF</span></span>
<span>                 ,group <span class="op">=</span> <span class="va">source</span>,color <span class="op">=</span> <span class="va">source</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># add local EF</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">cur_local_ef_dt</span><span class="op">$</span><span class="va">EF</span><span class="op">)</span></span>
<span>            ,colour <span class="op">=</span> <span class="st">"black"</span>,linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">19</span>,y <span class="op">=</span> <span class="va">cur_local_ef</span><span class="op">$</span><span class="va">EF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># add local EF text</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">19</span></span>
<span>                , y <span class="op">=</span> <span class="va">cur_local_ef_dt</span><span class="op">$</span><span class="va">EF</span><span class="op">)</span></span>
<span>            ,label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'Local EF = %s g/km at 19 km/h'</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cur_local_ef_dt</span><span class="op">$</span><span class="va">EF</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>            ,hjust <span class="op">=</span> <span class="fl">0</span>,nudge_y <span class="op">=</span> <span class="fl">100</span>,nudge_x <span class="op">=</span> <span class="fl">1</span></span>
<span>            ,size <span class="op">=</span> <span class="fl">3</span>,fontface <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># configs plots</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cur_scaled_ef_dt</span><span class="op">$</span><span class="va">EF</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="gtfs2emis_emission_factor_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p>In this case, the <code>scaled_EF</code> has the same value of <code>local_EF</code> (dashed line) when <code>speed = 19</code> km/h, and a similar decaying behavior as <code>Euro_EF</code> as speed decreases.</p>
</div>
</div>
<div class="section level2">
<h2 id="checking-gtfs2emis-imported-data">Checking <code>gtfs2emis</code> imported data<a class="anchor" aria-label="anchor" href="#checking-gtfs2emis-imported-data"></a>
</h2>
<p>Users can have a closer look to the emission factor data that included the package by using the following functions:</p>
<ul>
<li>
<code>data(ef_brazil_cetesb)</code> from Environment Company of Sao Paulo, Brazil (CETESB)</li>
<li>
<code>data(ef_usa_moves)</code> from MOtor Vehicle Emission Simulator (MOVES)</li>
<li>
<code>data(ef_usa_emfac)</code> from California Air Resources Board (EMFAC Model)</li>
<li>
<code>data(ef_europe_emep)</code> from European Environment Agency (EMEP/EEA)</li>
</ul>
<p>The data presented on the agencies website and software was downloaded and pre-processed in <code>gtfs2emis</code> to be easily read by the emission factor functions. Users can also access the scripts used to process raw data in the <a href="%22https://github.com/ipeaGIT/gtfs2emis/tree/master/data-raw%22" class="external-link">gtfs2emis GitHub repository</a>.</p>
</div>
<div class="section level2">
<h2 id="report-a-bug">Report a bug<a class="anchor" aria-label="anchor" href="#report-a-bug"></a>
</h2>
<p>If you have any suggestions or want to report an error, please visit <a href="https://github.com/ipeaGIT/gtfs2emis/issues" class="external-link">the package GitHub page</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Joao Bazzo, Rafael H. M. Pereira, Pedro R. Andrade.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
