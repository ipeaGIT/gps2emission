<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Exploring Emission Factors • gtfs2emis</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Exploring Emission Factors">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gtfs2emis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/gtfs2emis_emission_factor.html">Exploring Emission Factors</a></li>
    <li><a class="dropdown-item" href="../articles/gtfs2emis_fleet_data.html">Preparing fleet data for gtfs2emis</a></li>
    <li><a class="dropdown-item" href="../articles/gtfs2emis_intro_vignette.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/gtfs2emis_non_exhaust_ef.html">Exploring Non-Exhaust Emission Factors</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipeaGIT/gtfs2emis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Exploring Emission Factors</h1>
            
            <h4 data-toc-skip class="date">2025-01-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/gtfs2emis/blob/master/vignettes/gtfs2emis_emission_factor.Rmd" class="external-link"><code>vignettes/gtfs2emis_emission_factor.Rmd</code></a></small>
      <div class="d-none name"><code>gtfs2emis_emission_factor.Rmd</code></div>
    </div>

    
    
<p>Emission factor models tell us the mass of pollutants that are
expected to be emitted by a given vehicle given a few characteristics
such as vehicle age, type, fuel, technology, speed, and distance
traveled. Various environmental agencies develop these functional
relations based on data collected from local measurements. Understanding
how emission factor data work is very important to understand how the
emission estimates of a given vehicle or public transport system are
influenced by the methodological choices of which emission factor model
should be used. This vignette helps users explore the emission factors
data available in the <code>gtfs2emis</code> package.</p>
<div class="section level2">
<h2 id="available-emission-factor-models">Available emission factor models<a class="anchor" aria-label="anchor" href="#available-emission-factor-models"></a>
</h2>
<p>The <code>gtfs2emis</code> package currently includes hot-exhaust
emission factor data from four environmental agencies. Reports with
detailed information and methods on how these emission factor data were
originally calculated can be found on the agencies’ websites in the
links below</p>
<p><strong><em>Hot-exhaust emissions</em></strong></p>
<p>- Brazil, Environment Company of Sao Paulo — [CETESB]</p>
<p>- United States, Environmental Protection Agency — <a href="https://www.epa.gov/moves" class="external-link">MOVES3 Model</a></p>
<p>- United States, California Air Resources Board — <a href="https://arb.ca.gov/emfac/emissions-inventory" class="external-link">EMFAC2017
model</a></p>
<p>- Europe, European Environment Agency — <a href="https://www.eea.europa.eu//publications/emep-eea-guidebook-2019" class="external-link">EMEP-EEA</a></p>
<p><strong><em>Wear emissions (tire, brake and road
wear)</em></strong></p>
<p>- Europe, European Environment Agency — <a href="https://www.eea.europa.eu//publications/emep-eea-guidebook-2019" class="external-link">EMEP-EEA</a></p>
</div>
<div class="section level2">
<h2 id="visualizing-emission-factor-data">Visualizing emission factor data<a class="anchor" aria-label="anchor" href="#visualizing-emission-factor-data"></a>
</h2>
<p>Emission fator values vary by fleet characteristics — as shown in <a href="https://ipeagit.github.io/gtfs2emis/articles/gtfs2emis_fleet_data.html">Defining
Fleet data vignette</a>. In this section we will use the
<code><a href="../reference/ef_europe_emep.html">ef_europe_emep()</a></code> function and look at three types of urban
buses (Midi, Standard and Articulated) to illustrate how emissions vary
according to vehicle type, average speed, and pollutant.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(gtfs2emis)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-quantities.github.io/units/" class="external-link">units</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/gtfs2emis/">gtfs2emis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">ef_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_europe_emep.html">ef_europe_emep</a></span><span class="op">(</span>speed <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>,<span class="st">"km/h"</span><span class="op">)</span></span>
<span>                            ,veh_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ubus Midi &lt;=15 t"</span></span>
<span>                                          ,<span class="st">"Ubus Std 15 - 18 t"</span></span>
<span>                                          ,<span class="st">"Ubus Artic &gt;18 t"</span><span class="op">)</span></span>
<span>                            ,euro <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"III"</span>, <span class="st">"IV"</span>, <span class="st">"V"</span><span class="op">)</span></span>
<span>                            ,pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PM10"</span>, <span class="st">"NOx"</span><span class="op">)</span></span>
<span>                            ,fuel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"D"</span>, <span class="st">"D"</span><span class="op">)</span></span>
<span>                            ,tech <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">"SCR"</span>, <span class="st">"SCR"</span><span class="op">)</span></span>
<span>                            ,as_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ef_europe</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "pollutant" "veh_type"  "euro"      "fuel"      "tech"      "process"  </span></span>
<span><span class="co">#&gt;  [7] "slope"     "load"      "speed"     "EF"</span></span></code></pre></div>
<p>In the case above, the function returns a <code>list</code> that
contains all the relevant information for the emission factor — shown in
<code>names(ef_europe)</code>. However, it may be useful to check the
emission factor results in a <code>data.frame</code> or graphic
format.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ef_europe_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emis_to_dt.html">emis_to_dt</a></span><span class="op">(</span>emi_list <span class="op">=</span> <span class="va">ef_europe</span></span>
<span>                           ,emi_vars <span class="op">=</span> <span class="st">"EF"</span></span>
<span>                           ,veh_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"veh_type"</span>,<span class="st">"euro"</span>,<span class="st">"fuel"</span>,<span class="st">"tech"</span><span class="op">)</span></span>
<span>                           ,pol_vars <span class="op">=</span> <span class="st">"pollutant"</span></span>
<span>                           ,segment_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"slope"</span>,<span class="st">"load"</span>,<span class="st">"speed"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ef_europe_dt</span><span class="op">)</span></span>
<span><span class="co">#&gt;            veh_type   euro   fuel   tech pollutant               EF     process</span></span>
<span><span class="co">#&gt;              &lt;char&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;char&gt;          &lt;units&gt;      &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: Ubus Midi &lt;=15 t    III      D      -      PM10 0.2559070 [g/km] hot_exhaust</span></span>
<span><span class="co">#&gt; 2: Ubus Midi &lt;=15 t    III      D      -      PM10 0.2559070 [g/km] hot_exhaust</span></span>
<span><span class="co">#&gt; 3: Ubus Midi &lt;=15 t    III      D      -      PM10 0.2413421 [g/km] hot_exhaust</span></span>
<span><span class="co">#&gt; 4: Ubus Midi &lt;=15 t    III      D      -      PM10 0.2285624 [g/km] hot_exhaust</span></span>
<span><span class="co">#&gt; 5: Ubus Midi &lt;=15 t    III      D      -      PM10 0.2172637 [g/km] hot_exhaust</span></span>
<span><span class="co">#&gt; 6: Ubus Midi &lt;=15 t    III      D      -      PM10 0.2072074 [g/km] hot_exhaust</span></span>
<span><span class="co">#&gt;    slope  load     speed</span></span>
<span><span class="co">#&gt;    &lt;num&gt; &lt;num&gt;   &lt;units&gt;</span></span>
<span><span class="co">#&gt; 1:     0   0.5 10 [km/h]</span></span>
<span><span class="co">#&gt; 2:     0   0.5 11 [km/h]</span></span>
<span><span class="co">#&gt; 3:     0   0.5 12 [km/h]</span></span>
<span><span class="co">#&gt; 4:     0   0.5 13 [km/h]</span></span>
<span><span class="co">#&gt; 5:     0   0.5 14 [km/h]</span></span>
<span><span class="co">#&gt; 6:     0   0.5 15 [km/h]</span></span></code></pre></div>
<p>Plotting the speed-dependent emission factors according to vehicle
type (<code>veh_type</code>) and euro standard (<code>euro</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ef_europe_dt</span><span class="op">$</span><span class="va">name_fleet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">ef_europe_dt</span><span class="op">$</span><span class="va">veh_type</span>, <span class="st">"/ Euro"</span></span>
<span>                                 , <span class="va">ef_europe_dt</span><span class="op">$</span><span class="va">euro</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ef_europe_dt</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span>,y <span class="op">=</span> <span class="va">EF</span>,color <span class="op">=</span> <span class="va">name_fleet</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Category / EURO"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">pollutant</span>,scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `scale_name` argument of `continuous_scale()` is deprecated as of ggplot2</span></span>
<span><span class="co">#&gt; 3.5.0.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="gtfs2emis_emission_factor_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>There are situations where the emission factor are not available for
a given input parameter. In the case of <code><a href="../reference/ef_europe_emep.html">ef_europe_emep()</a></code>
function, when the information on vehicle technology does not match the
existing database, the package displays a message indicating the
technology considered. Please check the message shown in the code block
below. In such case, users can either select existing data for the
combining variables (<code>euro</code>, <code>tech</code>,
<code>veh_type</code>, and <code>pollutant</code>), or accept the
assumed change in vehicle technology.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ef_europe_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_europe_emep.html">ef_europe_emep</a></span><span class="op">(</span>speed <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>,<span class="st">"km/h"</span><span class="op">)</span></span>
<span>                                ,veh_type <span class="op">=</span> <span class="st">"Ubus Std 15 - 18 t"</span></span>
<span>                                ,euro <span class="op">=</span> <span class="st">"VI"</span>,pollutant <span class="op">=</span> <span class="st">"CO2"</span></span>
<span>                                ,tech <span class="op">=</span> <span class="st">"DPF+SCR"</span></span>
<span>                                ,as_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'CO2' Emission factor not found for 'DPF+SCR' Technology and Euro 'VI'.</span></span>
<span><span class="co">#&gt;  The package assumed 'SCR' Technology entry. Please check `data(ef_europe_emep_db)` for available data.</span></span></code></pre></div>
<p>The other EF functions, <code><a href="../reference/ef_usa_emfac.html">ef_usa_emfac()</a></code>,
<code><a href="../reference/ef_usa_moves.html">ef_usa_moves()</a></code> and <code><a href="../reference/ef_brazil_cetesb.html">ef_brazil_cetesb()</a></code> work in
a similar way. See the functions documentation for more detail.</p>
<div class="section level3">
<h3 id="scaling-emission-factors-making-emission-factors-speed-dependent">Scaling Emission Factors: making emission factors
speed-dependent<a class="anchor" aria-label="anchor" href="#scaling-emission-factors-making-emission-factors-speed-dependent"></a>
</h3>
<p>For most models (MOVES3, EMEP-EEA and EMFAC2017), emission factors
depend on a vehicle’s speed. However, the emission factors developed for
Brazil by CETESB (<code><a href="../reference/ef_brazil_cetesb.html">ef_brazil_cetesb()</a></code>) do not vary by
vehicle speed. In such a case, users can “scale” or adjust the local
emission factor values to make them speed-dependent using the function
<code><a href="../reference/ef_scaled_euro.html">ef_scaled_euro()</a></code>.</p>
<p>When using the EMEP-EEA model as a reference, the scaled emission
factor varies according to vehicle’s speed following the expression:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi><msub><mi>F</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>*</mo><mfrac><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>e</mi><mi>u</mi><mi>r</mi><mi>o</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>e</mi><mi>u</mi><mi>r</mi><mi>o</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mi>D</mi><mi>C</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">
EF_{scaled} (V) = EF_{local} * \frac{EF_{euro}(V)}{EF_{euro}(SDC)}, 
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">EF_{scaled}(V)</annotation></semantics></math>
is the scaled emission factor for each street link,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">EF_{local}</annotation></semantics></math>
is the local emission factor,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>e</mi><mi>u</mi><mi>r</mi><mi>o</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">EF_{euro}(V)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>e</mi><mi>u</mi><mi>r</mi><mi>o</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mi>D</mi><mi>C</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">EF_{euro}(SDC)</annotation></semantics></math>
are the EMEP/EEA emission factor the speed of V and the average urban
driving speed SDC, respectively.</p>
<p>The scaled behavior of EF can be verified graphically when we plot
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">EF_{local}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">EF_{scaled}(V)</annotation></semantics></math>,
and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>F</mi><mrow><mi>e</mi><mi>u</mi><mi>r</mi><mi>o</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">EF_{euro}(V)</annotation></semantics></math>
that is used as the reference To plot these data, we need six quick
steps:</p>
<ol style="list-style-type: decimal">
<li>Build a <code>data.frame</code> of fleet indicating the
correspondence between the fleet characteristic in the local and
European emission models</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fleet_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/bra_cur_fleet.txt"</span>, package <span class="op">=</span> <span class="st">"gtfs2emis"</span><span class="op">)</span></span>
<span><span class="va">cur_fleet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fleet_filepath</span>,header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">","</span>, nrows <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cur_fleet</span></span>
<span><span class="co">#&gt;   year euro shape_id type_name_br           veh_type total fuel</span></span>
<span><span class="co">#&gt; 1 2006  III     1849  BUS_URBAN_D Ubus Std 15 - 18 t     2    D</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Estimate local emission factors</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cur_local_ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_brazil_cetesb.html">ef_brazil_cetesb</a></span><span class="op">(</span>pollutant <span class="op">=</span> <span class="st">"CO2"</span></span>
<span>                                 ,veh_type <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">type_name_br</span></span>
<span>                                 ,model_year <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cur_local_ef</span><span class="op">)</span></span>
<span><span class="co">#&gt; $pollutant</span></span>
<span><span class="co">#&gt; [1] "CO2"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $veh_type</span></span>
<span><span class="co">#&gt; [1] "BUS_URBAN_D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $model_year</span></span>
<span><span class="co">#&gt; [1] 2006</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $EF</span></span>
<span><span class="co">#&gt; Units: [g/km]</span></span>
<span><span class="co">#&gt;      CO2_2006</span></span>
<span><span class="co">#&gt; [1,] 1385.626</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $process</span></span>
<span><span class="co">#&gt; [1] "hot_exhaust"</span></span>
<span></span>
<span><span class="co"># convert Local EF to data.frame</span></span>
<span><span class="va">cur_local_ef_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emis_to_dt.html">emis_to_dt</a></span><span class="op">(</span>emi_list <span class="op">=</span> <span class="va">cur_local_ef</span></span>
<span>                             ,emi_vars <span class="op">=</span> <span class="st">"EF"</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Estimate <code>ef_emep_europe</code>
</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Euro EF</span></span>
<span><span class="va">cur_euro_ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_europe_emep.html">ef_europe_emep</a></span><span class="op">(</span>speed <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>,<span class="st">"km/h"</span><span class="op">)</span></span>
<span>                              ,veh_type <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">veh_type</span></span>
<span>                              ,euro <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">euro</span></span>
<span>                              ,pollutant <span class="op">=</span> <span class="st">"CO2"</span></span>
<span>                              ,tech <span class="op">=</span> <span class="st">"-"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to data.frame</span></span>
<span><span class="va">cur_euro_ef_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emis_to_dt.html">emis_to_dt</a></span><span class="op">(</span>emi_list <span class="op">=</span> <span class="va">cur_euro_ef</span></span>
<span>                             ,emi_vars <span class="op">=</span> <span class="st">"EF"</span></span>
<span>                             ,veh_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"veh_type"</span>,<span class="st">"euro"</span>,<span class="st">"fuel"</span>,<span class="st">"tech"</span><span class="op">)</span></span>
<span>                             ,segment_vars <span class="op">=</span> <span class="st">"speed"</span><span class="op">)</span></span>
<span><span class="va">cur_euro_ef_dt</span><span class="op">$</span><span class="va">source</span> <span class="op">&lt;-</span> <span class="st">"Euro EF"</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Apply <code><a href="../reference/ef_scaled_euro.html">ef_scaled_euro()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cur_scaled_ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ef_scaled_euro.html">ef_scaled_euro</a></span><span class="op">(</span>ef_local <span class="op">=</span> <span class="va">cur_local_ef</span><span class="op">$</span><span class="va">EF</span></span>
<span>                                ,speed <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>,<span class="st">"km/h"</span><span class="op">)</span></span>
<span>                                ,veh_type <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">veh_type</span></span>
<span>                                ,euro <span class="op">=</span> <span class="va">cur_fleet</span><span class="op">$</span><span class="va">euro</span></span>
<span>                                ,pollutant <span class="op">=</span> <span class="st">"CO2"</span></span>
<span>                                ,tech <span class="op">=</span> <span class="st">"-"</span></span>
<span>                                <span class="op">)</span></span>
<span><span class="co"># convert to data.frame</span></span>
<span><span class="va">cur_scaled_ef_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emis_to_dt.html">emis_to_dt</a></span><span class="op">(</span>emi_list <span class="op">=</span> <span class="va">cur_scaled_ef</span></span>
<span>                               ,emi_vars <span class="op">=</span> <span class="st">"EF"</span></span>
<span>                               ,veh_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"veh_type"</span>,<span class="st">"euro"</span>,<span class="st">"fuel"</span>,<span class="st">"tech"</span><span class="op">)</span></span>
<span>                               ,segment_vars <span class="op">=</span> <span class="st">"speed"</span><span class="op">)</span></span>
<span><span class="va">cur_scaled_ef_dt</span><span class="op">$</span><span class="va">source</span> <span class="op">&lt;-</span> <span class="st">"Scaled EF"</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>View in ggplot2</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rbind data</span></span>
<span><span class="va">cur_ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cur_euro_ef_dt</span>, <span class="va">cur_scaled_ef_dt</span><span class="op">)</span></span>
<span><span class="va">cur_ef</span><span class="op">$</span><span class="va">source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cur_ef</span><span class="op">$</span><span class="va">source</span></span>
<span>                        ,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Scaled EF"</span>, <span class="st">"Euro EF"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># add scaled and euro EF</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cur_ef</span></span>
<span>            ,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span>,y <span class="op">=</span> <span class="va">EF</span></span>
<span>                 ,group <span class="op">=</span> <span class="va">source</span>,color <span class="op">=</span> <span class="va">source</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># add local EF</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">cur_local_ef_dt</span><span class="op">$</span><span class="va">EF</span><span class="op">)</span></span>
<span>            ,colour <span class="op">=</span> <span class="st">"black"</span>,linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">19</span>,<span class="st">'km/h'</span><span class="op">)</span></span>
<span>                 ,y <span class="op">=</span> <span class="va">cur_local_ef</span><span class="op">$</span><span class="va">EF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># add local EF text</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">19</span>,<span class="st">'km/h'</span><span class="op">)</span></span>
<span>                , y <span class="op">=</span> <span class="va">cur_local_ef_dt</span><span class="op">$</span><span class="va">EF</span><span class="op">)</span></span>
<span>            ,label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'Local EF = %s g/km at 19 km/h'</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cur_local_ef_dt</span><span class="op">$</span><span class="va">EF</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>            ,hjust <span class="op">=</span> <span class="fl">0</span>,nudge_y <span class="op">=</span> <span class="fl">100</span>,nudge_x <span class="op">=</span> <span class="fl">1</span></span>
<span>            ,size <span class="op">=</span> <span class="fl">3</span>,fontface <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># configs plots</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cur_scaled_ef_dt</span><span class="op">$</span><span class="va">EF</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="gtfs2emis_emission_factor_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>In this case, the <code>scaled_EF</code> has the same value of
<code>local_EF</code> (dashed line) when <code>speed = 19</code> km/h,
and a similar decaying behavior as <code>Euro_EF</code> as speed
decreases.</p>
</div>
</div>
<div class="section level2">
<h2 id="checking-gtfs2emis-imported-data">Checking <code>gtfs2emis</code> imported data<a class="anchor" aria-label="anchor" href="#checking-gtfs2emis-imported-data"></a>
</h2>
<p>Users can have a closer look to the hot-exhaust emission factor data
included in the package by using the following functions:</p>
<ul>
<li>
<code>data(ef_brazil_cetesb)</code> from Environment Company of Sao
Paulo, Brazil (CETESB)</li>
<li>
<code>data(ef_usa_moves)</code> from MOtor Vehicle Emission
Simulator (MOVES)</li>
<li>
<code>data(ef_usa_emfac)</code> from California Air Resources Board
(EMFAC Model)</li>
<li>
<code>data(ef_europe_emep)</code> from European Environment Agency
(EMEP/EEA)</li>
</ul>
<p>The data presented on the agencies website and software was
downloaded and pre-processed in <code>gtfs2emis</code> to be easily read
by the emission factor functions. Users can also access the scripts used
to process raw data in the <a href="https://github.com/ipeaGIT/gtfs2emis/tree/master/data-raw" class="external-link">gtfs2emis
GitHub repository</a>.</p>
</div>
<div class="section level2">
<h2 id="learn-more">Learn more<a class="anchor" aria-label="anchor" href="#learn-more"></a>
</h2>
<p>Check out our extra guides:</p>
<ul>
<li><a href="https://ipeagit.github.io/gtfs2emis/articles/gtfs2emis_non_exhaust_ef.html">Exploring
Non-Exhaust Emission Factors</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="report-a-bug">Report a bug<a class="anchor" aria-label="anchor" href="#report-a-bug"></a>
</h2>
<p>If you have any suggestions or want to report an error, please visit
<a href="https://github.com/ipeaGIT/gtfs2emis/issues" class="external-link">the package GitHub
page</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joao Bazzo, Rafael H. M. Pereira, Pedro R. Andrade, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
