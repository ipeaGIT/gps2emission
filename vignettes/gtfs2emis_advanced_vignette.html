<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Joao Bazzo, Rafael H. M. Pereira, Pedro R. Andrade" />

<meta name="date" content="2022-05-01" />

<title>Introduction to gtfs2emis</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>

<style type="text/css">
  p.abstract{
    text-align: center;
    font-weight: bold;
  }
  div.abstract{
    margin: auto;
    width: 90%;
  }
</style>



<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Introduction to gtfs2emis</h1>
<h4 class="author">Joao Bazzo, Rafael H. M. Pereira, Pedro R. Andrade</h4>
<h4 class="date">2022-05-01</h4>
<div class="abstract">
<p class="abstract">Abstract</p>
Advanced functionalities to estimate public transport emissions using the <code>gtfs2emis</code> package
</div>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The package <code>gtfs2emis</code> helps users estimate hot exhaust emissions of public transport systems based on GTFS and fleet characteristics data.</p>
</div>
<div id="installation" class="section level1">
<h1>Installation</h1>
<p>You can install <code>gtfs2emis</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From CRAN</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;gtfs2emis&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># or use the development version with latest features</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">remove.packages</span>(<span class="st">&#39;gtfs2emis&#39;</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;ipeaGIT/gtfs2emis&quot;</span>)</span></code></pre></div>
<p>This vignette introduces the main functions of the <code>gtfs2mies</code> package. We will be using the following packages:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtfs2emis)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtfstools)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtfs2gps)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: package &#39;gtfs2gps&#39; was built under R version 4.1.3</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
</div>
<div id="approach" class="section level1">
<h1>Approach</h1>
<p>The package has two main usages that will ultimately depend on the user’s experience and on the desired output:</p>
<p><strong>1. Basic usage</strong></p>
<ul>
<li>Emissions inventory is straightforward, making it more friendly for new users;</li>
<li>It is divided into <code>transport_model()</code> and <code>emissions_model()</code> functions;</li>
<li>In the <code>emissions_model()</code> the user specifies the source of emission factors;</li>
<li>It uses several default approaches for hot exhaust emissions inventory;</li>
<li>It considers the fleet to be homogeneously distributed across the vehicle routes.</li>
</ul>
<p><strong>2. Detailed usage</strong></p>
<ul>
<li>It uses step-by-step functions to produce the transport and emissions model: User can specific any correction on speed distribution over routes;</li>
<li>It allocates specific vehicles into predefined routes, e.g. articulated buses into specific shape_id’s;</li>
<li>It adjusts emissions factors (fuel correction, scaling non-speed dependent emission factors with Environmental European Agency (EMEP-EEA) emissions factors, checking emission factors before using in the inventory).</li>
</ul>
<div id="basic-usage" class="section level2">
<h2>Basic Usage</h2>
<p><strong>1. Read data</strong><br />
The first step selects the GTFS and the desired route to model emissions. Here we use one example of <code>shape_id == &quot;176-1&quot;</code> in Porto Alegre (Brazil). Detailed functions of GTFS editing can be found in <code>gtfs2gps</code> and <code>gtfstools</code> packages.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gtfs <span class="ot">&lt;-</span> <span class="fu">read_gtfs</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata/poa.zip&quot;</span>, <span class="at">package =</span> <span class="st">&quot;gtfs2gps&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_week_days</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_by_shape_id</span>(., <span class="st">&quot;176-1&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_single_trip</span>()</span></code></pre></div>
<p><strong>2. Transport model</strong><br />
The <code>transport_model()</code> accepts either a GTFS data or a filepath where the data is stored. It converts the GTFS into a GPS-like data.table, fixing extreme or missing values of speed and transforming the output into a sf-linestring, which is the required input for emissions estimates.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sf_line <span class="ot">&lt;-</span> <span class="fu">transport_model</span>(<span class="at">gtfs =</span> gtfs,<span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Visualizing the transport model output for <code>shape_id == &quot;176-1&quot;</code> of Porto Alegre (Brazil).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sf_line<span class="sc">$</span>geometry)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry set for 2 features </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -51.25528 ymin: -30.16306 xmax: -51.217 ymax: -30.02311</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>sf_line <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(sf_line)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf_line[<span class="st">&quot;trip_number&quot;</span>])</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p><strong>3. Fleet data</strong><br />
After generating the transport model, we advance to estimate the hot exhaust emissions. We create a data.frame with fleet information, which can also be imported from an external file. There are two main key features of fleet data:</p>
<ul>
<li>If the user has fleet data but does not have information on the relations between buses and routes (e.g Articulated buses to <code>shape_id</code> <code>XX</code>, <code>YY</code> or <code>ZZ</code>), she can assign a probability of each fleet type into the routes. If the class of a given route is known, the probability is equals to 1, always assigning the same class to the route. The sum of all probabilities of each route must be one.</li>
<li>The fleet data needs to be organized according to the desired emission factor database. For instance, if the user wants to estimate emissions based on typical European fleet, she must present the data according to the typical emission factors inputs for Emep-EEA methodology. In this example, the data is organized according to the requirements for <code>ef_emep_europe()</code> emission factor data. Users can check in <code>ef_moves_usa()</code>, <code>ef_emfac_usa()</code>, <code>ef_cetesb_brazil()</code> or <code>ef_emep_europe()</code> how the fleet must be organized.</li>
</ul>
<p>In the example of European emission factors, we use three vehicles classes. A given <code>shape_id</code> has 40%, 50%, and 10% chance of having <code>Ubus Midi &lt;=15 t</code>, <code>Ubus Std 15 - 18 t</code>, and <code>Ubus Artic &gt;18 t</code>, respectively.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_europe <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="st">&quot;veh_type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Ubus Midi &lt;=15 t&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                                                              ,<span class="st">&quot;Ubus Std 15 - 18 t&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                                                              ,<span class="st">&quot;Ubus Artic &gt;18 t&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;euro&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;III&quot;</span>,<span class="st">&quot;IV&quot;</span>,<span class="st">&quot;V&quot;</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;fuel&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">&quot;D&quot;</span>,<span class="dv">3</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;tech&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>,<span class="st">&quot;SCR&quot;</span>,<span class="st">&quot;SCR&quot;</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;fleet_composition&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_europe</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              veh_type euro fuel tech fleet_composition</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:   Ubus Midi &lt;=15 t  III    D    -               0.4</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: Ubus Std 15 - 18 t   IV    D  SCR               0.5</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:   Ubus Artic &gt;18 t    V    D  SCR               0.1</span></span></code></pre></div>
<p>This data.table is quite similar to other emissions factors database sources. Three other examples are described below.</p>
<p>Emission Factor Model (California Air Resources Board):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_emfac <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="st">&quot;veh_type&quot;</span> <span class="ot">=</span> <span class="st">&quot;BUS_URBAN_D&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                                              ,<span class="st">&quot;model_year&quot;</span> <span class="ot">=</span> <span class="dv">2011</span><span class="sc">:</span><span class="dv">2015</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                                              ,<span class="st">&quot;fuel&quot;</span> <span class="ot">=</span> <span class="st">&quot;D&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                              ,<span class="st">&quot;calendar_year&quot;</span> <span class="ot">=</span> <span class="dv">2019</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                              ,<span class="st">&quot;fleet_composition&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fl">0.2</span>,<span class="dv">5</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_emfac</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       veh_type model_year fuel calendar_year fleet_composition</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: BUS_URBAN_D       2011    D          2019               0.2</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: BUS_URBAN_D       2012    D          2019               0.2</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: BUS_URBAN_D       2013    D          2019               0.2</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4: BUS_URBAN_D       2014    D          2019               0.2</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5: BUS_URBAN_D       2015    D          2019               0.2</span></span></code></pre></div>
<p>MOtor Vehicle Emission Simulator (MOVES) from Environmental Protection Agency (United States):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_moves <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="st">&quot;veh_type&quot;</span> <span class="ot">=</span> <span class="st">&quot;BUS_URBAN_D&quot;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                                              ,<span class="st">&quot;model_year&quot;</span> <span class="ot">=</span> <span class="dv">2011</span><span class="sc">:</span><span class="dv">2015</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                                              ,<span class="st">&quot;fuel&quot;</span> <span class="ot">=</span> <span class="st">&quot;D&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                                              ,<span class="st">&quot;calendar_year&quot;</span> <span class="ot">=</span> <span class="dv">2016</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                                              ,<span class="st">&quot;fleet_composition&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fl">0.2</span>,<span class="dv">5</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_moves</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       veh_type model_year fuel calendar_year fleet_composition</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: BUS_URBAN_D       2011    D          2016               0.2</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: BUS_URBAN_D       2012    D          2016               0.2</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: BUS_URBAN_D       2013    D          2016               0.2</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4: BUS_URBAN_D       2014    D          2016               0.2</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5: BUS_URBAN_D       2015    D          2016               0.2</span></span></code></pre></div>
<p>Environmental Company of São Paulo (CETESB, Brazil):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_cetesb <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="st">&quot;veh_type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;BUS_MICRO_D&quot;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                                                              ,<span class="st">&quot;BUS_URBAN_D&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                                                              ,<span class="st">&quot;BUS_ARTIC_D&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;model_year&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">2010</span>, <span class="dv">3</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;fuel&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">&quot;D&quot;</span>, <span class="dv">3</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;fleet_composition&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_cetesb</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       veh_type model_year fuel fleet_composition</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: BUS_MICRO_D       2010    D               0.4</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: BUS_URBAN_D       2010    D               0.4</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: BUS_ARTIC_D       2010    D               0.2</span></span></code></pre></div>
<p><strong>4. Emissions model</strong><br />
To generate the emission results, we couple the results from <code>transport_model()</code> along with the <code>fleet_data</code> previously imported. The <code>emission_model</code> generates a list of several files related to emissions, storing information such as vehicle variables (<code>fuel</code>, <code>age</code>, <code>tech</code>, <code>euro</code>, <code>fleet_composition</code>), travel variables (<code>slope</code>, <code>load</code>, <code>gps</code>) or pollution (<code>EF</code>, <code>emi</code>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sf_emis <span class="ot">&lt;-</span> <span class="fu">emission_model</span>(<span class="at">gps =</span> sf_line</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">ef_data_base =</span> <span class="st">&quot;emep_europe&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">fleet_data =</span> fleet_data_ef_europe</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">pollutant =</span> <span class="fu">c</span>(<span class="st">&quot;CO&quot;</span>,<span class="st">&quot;PM10&quot;</span>,<span class="st">&quot;CO2&quot;</span>,<span class="st">&quot;CH4&quot;</span>,<span class="st">&quot;NOx&quot;</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sf_emis)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sf_emis)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;pollutant&quot;         &quot;veh_type&quot;          &quot;euro&quot;             </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [4] &quot;fuel&quot;              &quot;tech&quot;              &quot;slope&quot;            </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;load&quot;              &quot;EF&quot;                &quot;emi&quot;              </span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [10] &quot;fleet_composition&quot; &quot;gps&quot;</span></span></code></pre></div>
<p><strong>5. Data post-processing</strong><br />
As the results are stored in a long list, gtfs2emis package has several function to post-process the results. <code>emis_summary</code> summarizes the emissions according to the variable of interest, such as vehicle type <code>veh_type</code>, <code>pollutant</code>, or <code>time</code>. In the last case, we need to add a <code>time_column</code> in the list, as this information is not returned by <code>emission_model()</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sf_emis<span class="sc">$</span>time_column <span class="ot">&lt;-</span> sf_emis<span class="sc">$</span>gps<span class="sc">$</span>timestamp</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sf_emis)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;pollutant&quot;         &quot;veh_type&quot;          &quot;euro&quot;             </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [4] &quot;fuel&quot;              &quot;tech&quot;              &quot;slope&quot;            </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;load&quot;              &quot;EF&quot;                &quot;emi&quot;              </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [10] &quot;fleet_composition&quot; &quot;gps&quot;               &quot;time_column&quot;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>my_emis_summary <span class="ot">&lt;-</span> <span class="fu">emis_summary</span>(<span class="at">emi_list =</span> sf_emis,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">emi_var =</span> <span class="st">&quot;emi&quot;</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="st">&quot;time&quot;</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">time_column =</span> <span class="st">&quot;time_column&quot;</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">veh_var =</span> <span class="st">&quot;veh_type&quot;</span>, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pol_var =</span> <span class="st">&quot;pollutant&quot;</span>) </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>my_emis_summary</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    time_column pollutant              emi</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:           6        CO    35.555250 [g]</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:           6      PM10     1.999375 [g]</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:           6       CO2 19685.823245 [g]</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:           6       CH4     1.041536 [g]</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5:           6       NOx   146.596574 [g]</span></span></code></pre></div>
<p>To visualize results by vehicle type <code>veh_type</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>my_emis_summary <span class="ot">&lt;-</span> <span class="fu">emis_summary</span>(<span class="at">emi_list =</span> sf_emis,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">emi_var =</span> <span class="st">&quot;emi&quot;</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;veh_type&quot;</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">time_column =</span> <span class="st">&quot;time_column&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">veh_var =</span> <span class="st">&quot;veh_type&quot;</span>, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">pol_var =</span> <span class="st">&quot;pollutant&quot;</span>) </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>my_emis_summary</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               veh_type pollutant              emi</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:   Ubus Midi &lt;=15 t        CO 1.559449e+01 [g]</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2: Ubus Std 15 - 18 t        CO 1.328419e+01 [g]</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:   Ubus Artic &gt;18 t        CO 6.676565e+00 [g]</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:   Ubus Midi &lt;=15 t      PM10 1.304821e+00 [g]</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5: Ubus Std 15 - 18 t      PM10 5.441214e-01 [g]</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:   Ubus Artic &gt;18 t      PM10 1.504329e-01 [g]</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:   Ubus Midi &lt;=15 t       CO2 6.592714e+03 [g]</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8: Ubus Std 15 - 18 t       CO2 1.044825e+04 [g]</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:   Ubus Artic &gt;18 t       CO2 2.644856e+03 [g]</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:   Ubus Midi &lt;=15 t       CH4 9.677267e-01 [g]</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11: Ubus Std 15 - 18 t       CH4 6.150805e-02 [g]</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12:   Ubus Artic &gt;18 t       CH4 1.230161e-02 [g]</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13:   Ubus Midi &lt;=15 t       NOx 6.504679e+01 [g]</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14: Ubus Std 15 - 18 t       NOx 6.753369e+01 [g]</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15:   Ubus Artic &gt;18 t       NOx 1.401609e+01 [g]</span></span></code></pre></div>
<p>If available in <code>names(sf_emis)</code>, it is possible to add extra argument about fleet.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>my_emis_summary <span class="ot">&lt;-</span> <span class="fu">emis_summary</span>(<span class="at">emi_list =</span> sf_emis,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">emi_var =</span> <span class="st">&quot;emi&quot;</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">by =</span> <span class="st">&quot;veh_type&quot;</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">time_column =</span> <span class="st">&quot;time_column&quot;</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">veh_var =</span> <span class="fu">c</span>(<span class="st">&quot;veh_type&quot;</span>, <span class="st">&quot;euro&quot;</span>, <span class="st">&quot;fuel&quot;</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">pol_var =</span> <span class="st">&quot;pollutant&quot;</span>) </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>my_emis_summary</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               veh_type euro fuel pollutant              emi</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1:   Ubus Midi &lt;=15 t  III    D        CO 1.559449e+01 [g]</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2: Ubus Std 15 - 18 t   IV    D        CO 1.328419e+01 [g]</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3:   Ubus Artic &gt;18 t    V    D        CO 6.676565e+00 [g]</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4:   Ubus Midi &lt;=15 t  III    D      PM10 1.304821e+00 [g]</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5: Ubus Std 15 - 18 t   IV    D      PM10 5.441214e-01 [g]</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6:   Ubus Artic &gt;18 t    V    D      PM10 1.504329e-01 [g]</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7:   Ubus Midi &lt;=15 t  III    D       CO2 6.592714e+03 [g]</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8: Ubus Std 15 - 18 t   IV    D       CO2 1.044825e+04 [g]</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9:   Ubus Artic &gt;18 t    V    D       CO2 2.644856e+03 [g]</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10:   Ubus Midi &lt;=15 t  III    D       CH4 9.677267e-01 [g]</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11: Ubus Std 15 - 18 t   IV    D       CH4 6.150805e-02 [g]</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12:   Ubus Artic &gt;18 t    V    D       CH4 1.230161e-02 [g]</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13:   Ubus Midi &lt;=15 t  III    D       NOx 6.504679e+01 [g]</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14: Ubus Std 15 - 18 t   IV    D       NOx 6.753369e+01 [g]</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15:   Ubus Artic &gt;18 t    V    D       NOx 1.401609e+01 [g]</span></span></code></pre></div>
<p>Checking the results by pollutant:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>my_emis_summary <span class="ot">&lt;-</span> <span class="fu">emis_summary</span>(<span class="at">emi_list =</span> sf_emis,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">emi_var =</span> <span class="st">&quot;emi&quot;</span>, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;pollutant&quot;</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">time_column =</span> <span class="st">&quot;time_column&quot;</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">veh_var =</span> <span class="st">&quot;veh_type&quot;</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">pol_var =</span> <span class="st">&quot;pollutant&quot;</span>) </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>my_emis_summary</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    pollutant              emi</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:        CO    35.555250 [g]</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:      PM10     1.999375 [g]</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:       CO2 19685.823245 [g]</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:       CH4     1.041536 [g]</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5:       NOx   146.596574 [g]</span></span></code></pre></div>
<p>If the user wants to have all results in a data.table format:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sf_emis<span class="sc">$</span>time_column <span class="ot">&lt;-</span> sf_emis<span class="sc">$</span>gps<span class="sc">$</span>timestamp</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>my_emis_dt <span class="ot">&lt;-</span> <span class="fu">emi_to_dt</span>(<span class="at">emi_list =</span> sf_emis</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                    ,<span class="at">emi_vars =</span> <span class="st">&quot;emi&quot;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                    ,<span class="at">veh_vars =</span> <span class="fu">c</span>(<span class="st">&quot;veh_type&quot;</span>, <span class="st">&quot;euro&quot;</span>, <span class="st">&quot;fuel&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                    ,<span class="at">pol_vars =</span> <span class="st">&quot;pollutant&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                    ,<span class="at">segment_vars =</span> <span class="st">&quot;time_column&quot;</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my_emis_dt, <span class="dv">5</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              veh_type euro fuel pollutant           emi time_column segment_id</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:   Ubus Midi &lt;=15 t  III    D        CO 15.594492 [g]       21720          1</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:   Ubus Midi &lt;=15 t  III    D        CO        NA [g]       24840          2</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: Ubus Std 15 - 18 t   IV    D        CO 13.284193 [g]       21720          1</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4: Ubus Std 15 - 18 t   IV    D        CO        NA [g]       24840          2</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5:   Ubus Artic &gt;18 t    V    D        CO  6.676565 [g]       21720          1</span></span></code></pre></div>
<p>To visualize emissions spatially in a grid, the user nees to provide info about the desired grid. An operation of intersection can be done using <code>emis_grid()</code>. Here, we use <code>vein::make_grid()</code> to produce a basic grid.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>grid_gps <span class="ot">&lt;-</span> vein<span class="sc">::</span><span class="fu">make_grid</span>(<span class="at">spobj =</span> sf_emis<span class="sc">$</span>gps, <span class="at">width =</span>  <span class="fl">0.25</span> <span class="sc">/</span> <span class="fl">102.47</span>) <span class="co"># 500 meters</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of lon points: 16</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of lat points: 58</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>grid_gps <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(grid_gps)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sf_emis<span class="sc">$</span>emi)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;CO_Euro_III&quot;   &quot;CO_Euro_IV&quot;    &quot;CO_Euro_V&quot;     &quot;PM10_Euro_III&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;PM10_Euro_IV&quot;  &quot;PM10_Euro_V&quot;   &quot;CO2_Euro_III&quot;  &quot;CO2_Euro_IV&quot;  </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;CO2_Euro_V&quot;    &quot;CH4_Euro_III&quot;  &quot;CH4_Euro_IV&quot;   &quot;CH4_Euro_V&quot;   </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;NOx_Euro_III&quot;  &quot;NOx_Euro_IV&quot;   &quot;NOx_Euro_V&quot;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># we add info of emissions into gps file</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>sf_emis<span class="sc">$</span>gps <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sf_emis<span class="sc">$</span>gps,sf_emis<span class="sc">$</span>emi)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>pol_grid <span class="ot">&lt;-</span> <span class="fu">emis_grid</span>(<span class="at">data =</span> sf_emis<span class="sc">$</span>gps,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">emi =</span> <span class="st">&quot;CO_Euro_IV&quot;</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">grid =</span> grid_gps,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">time_class =</span> <span class="st">&#39;all periods&#39;</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pol_grid[<span class="st">&quot;CO_Euro_IV&quot;</span>])</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="detailed-usage" class="section level2">
<h2>Detailed Usage</h2>
<p>The detailed usage of <code>gtfs2emis</code> has intermediate functions to generate the transport and emissions model. In this case, the user can provide data of fleet distributed according to routes.</p>
<p><strong>1. Read data</strong></p>
<p>Users can provide a vehicle specific data for each <code>shape_id</code>. The example below shows a situation where the vehicle characteristics is known for three <code>shape_id</code>s (<code>T2-1</code>,<code>A141-1</code>, <code>176-1</code>), but is unknown for <code>R10-2</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>gtfs <span class="ot">&lt;-</span> <span class="fu">read_gtfs</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata/poa.zip&quot;</span>, <span class="at">package=</span><span class="st">&quot;gtfs2gps&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_week_days</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_single_trip</span>()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>gtfs<span class="sc">$</span>stop_times[,arrival_time <span class="sc">:</span><span class="er">=</span> data.table<span class="sc">::</span><span class="fu">as.ITime</span>(arrival_time)]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>gtfs<span class="sc">$</span>stop_times[,departure_time <span class="sc">:</span><span class="er">=</span> data.table<span class="sc">::</span><span class="fu">as.ITime</span>(departure_time)]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>gps_poa <span class="ot">&lt;-</span> <span class="fu">gtfs2gps</span>(gtfs)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(gps_poa)</span></code></pre></div>
<p>We can also define different ranges of minimum and maximum allowed speeds, as well as average speed. In this case, we consider the average speed of 34 km/h.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>gps_poa_fix <span class="ot">&lt;-</span> <span class="fu">adjust_speed</span>(<span class="at">gps_data =</span> gps_poa</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">min_speed =</span> <span class="dv">5</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">max_speed =</span> <span class="dv">75</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">new_speed =</span> <span class="dv">34</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">clone =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>To convert the output to linestring:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>linestring_poa <span class="ot">&lt;-</span> <span class="fu">gps_as_sflinestring</span>(gps_poa_fix)</span></code></pre></div>
<p>Checking some basic statistics of the transport model:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(linestring_poa)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># speeds</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>linestring_poa[,<span class="fu">weighted.mean</span>(speed,dist),by<span class="ot">=</span>shape_id]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    shape_id        V1</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:    176-1 NA [km/h]</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:   A141-1 NA [km/h]</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:    R10-2 NA [km/h]</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:     T2-1 NA [km/h]</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>linestring_poa[,<span class="fu">min</span>(dist),by<span class="ot">=</span>shape_id]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    shape_id            V1</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:    176-1  60.44233 [m]</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:   A141-1  70.57579 [m]</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:    R10-2  87.13860 [m]</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:     T2-1 114.18493 [m]</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>linestring_poa[,<span class="fu">mean</span>(dist),by<span class="ot">=</span>shape_id]</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    shape_id            V1</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:    176-1 11730.930 [m]</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:   A141-1  2317.287 [m]</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:    R10-2 13362.834 [m]</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:     T2-1  5725.275 [m]</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>linestring_poa[,<span class="fu">max</span>(dist),by<span class="ot">=</span>shape_id]</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    shape_id            V1</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:    176-1 23401.417 [m]</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:   A141-1  6750.871 [m]</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:    R10-2 26638.529 [m]</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:     T2-1 16582.822 [m]</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_as_sf</span>(linestring_poa)[<span class="st">&quot;shape_id&quot;</span>],<span class="at">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p><strong>2. Fleet</strong></p>
<p>Users can provide a vehicle specific data for each <code>shape_id</code>. The example below shows a situation where the vehicle characteristics is known for three <code>shape_id</code>s (<code>T2-1</code>,<code>A141-1</code>, <code>176-1</code>) but is unknown for <code>R10-2</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_europe <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="st">&quot;veh_type&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Ubus Midi &lt;=15 t&quot;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                                                                  ,<span class="st">&quot;Ubus Std 15 - 18 t&quot;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                                                  ,<span class="st">&quot;Ubus Artic &gt;18 t&quot;</span>),<span class="dv">2</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;euro&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;III&quot;</span>,<span class="st">&quot;IV&quot;</span>,<span class="st">&quot;V&quot;</span>),<span class="dv">2</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;fuel&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">&quot;D&quot;</span>,<span class="dv">6</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;tech&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;-&quot;</span>,<span class="st">&quot;SCR&quot;</span>,<span class="st">&quot;SCR&quot;</span>),<span class="dv">2</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;fleet_composition&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">3</span>),<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">&quot;shape_id&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;T2-1&quot;</span>,<span class="st">&quot;A141-1&quot;</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                                               <span class="st">&quot;176-1&quot;</span>,<span class="fu">rep</span>(<span class="st">&quot;R10-2&quot;</span>,<span class="dv">3</span>)))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_europe</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              veh_type euro fuel tech fleet_composition shape_id</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:   Ubus Midi &lt;=15 t  III    D    -               1.0     T2-1</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: Ubus Std 15 - 18 t   IV    D  SCR               1.0   A141-1</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:   Ubus Artic &gt;18 t    V    D  SCR               1.0    176-1</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:   Ubus Midi &lt;=15 t  III    D    -               0.4    R10-2</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5: Ubus Std 15 - 18 t   IV    D  SCR               0.5    R10-2</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6:   Ubus Artic &gt;18 t    V    D  SCR               0.1    R10-2</span></span></code></pre></div>
<p>The sum of fleet composition per <code>shape_id</code> can also be checked:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fleet_data_ef_europe[,<span class="fu">sum</span>(fleet_composition),by <span class="ot">=</span> shape_id]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    shape_id V1</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:     T2-1  1</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:   A141-1  1</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:    176-1  1</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:    R10-2  1</span></span></code></pre></div>
<p><strong>3. Visualizing the Emission factors</strong></p>
<p>We use the european database of emission factors (EF). We can plot the EF to check how it behaves according to <code>speed</code> and <code>veh_type</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ef_europe <span class="ot">&lt;-</span> <span class="fu">ef_emep_europe</span>(<span class="at">speed =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">100</span>,<span class="st">&quot;km/h&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">veh_type =</span> <span class="fu">c</span>(<span class="st">&quot;Ubus Midi &lt;=15 t&quot;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                          ,<span class="st">&quot;Ubus Std 15 - 18 t&quot;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                          ,<span class="st">&quot;Ubus Artic &gt;18 t&quot;</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">euro =</span> <span class="fu">c</span>(<span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>, <span class="st">&quot;V&quot;</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">pollutant =</span> <span class="fu">c</span>(<span class="st">&quot;CO2&quot;</span>, <span class="st">&quot;NOx&quot;</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">fuel =</span> <span class="fu">rep</span>(<span class="st">&quot;D&quot;</span>, <span class="dv">3</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">tech =</span> <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;SCR&quot;</span>, <span class="st">&quot;SCR&quot;</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">as_list =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We can use the <code>emi_to_dt()</code> to process EF:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ef_europe<span class="sc">$</span>speed <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">100</span>,<span class="st">&quot;km/h&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ef_europe_dt <span class="ot">&lt;-</span> <span class="fu">emi_to_dt</span>(<span class="at">emi_list =</span> ef_europe</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">emi_vars =</span> <span class="st">&quot;EF&quot;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">veh_vars =</span> <span class="fu">c</span>(<span class="st">&quot;veh_type&quot;</span>, <span class="st">&quot;fuel&quot;</span>, <span class="st">&quot;euro&quot;</span>, <span class="st">&quot;tech&quot;</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">pol_vars =</span> <span class="st">&quot;pollutant&quot;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">segment_vars =</span> <span class="st">&quot;speed&quot;</span>)</span></code></pre></div>
<p>Let us now use a fleet name defined as as veh_type / euro_type</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(ef_europe_dt)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ef_europe_dt[,name_fleet <span class="sc">:</span><span class="er">=</span> <span class="fu">paste0</span>(veh_type, <span class="st">&quot; / Euro &quot;</span>, euro)]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ef_europe_dt) <span class="sc">+</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed,<span class="at">y =</span> EF,<span class="at">color =</span> name_fleet))<span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Category / EURO&quot;</span>)<span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>pollutant,<span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p><strong>4. Emissions estimates</strong></p>
<p>As the emissions varies with <code>shape_id</code> and <code>fleet</code>, we compute emissions separately, in a loop.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>linestring_poa<span class="sc">$</span>shape_id <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;176-1&quot;  &quot;A141-1&quot; &quot;R10-2&quot;  &quot;T2-1&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>emi_data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">unique</span>(gps_poa<span class="sc">$</span>shape_id),<span class="cf">function</span>(i){</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  tmp_ef_euro <span class="ot">&lt;-</span> <span class="fu">ef_emep_europe</span>(<span class="at">speed =</span> linestring_poa[shape_id <span class="sc">==</span> i]<span class="sc">$</span>speed,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">veh_type =</span> fleet_data_ef_europe[shape_id <span class="sc">==</span> i]<span class="sc">$</span>veh_type</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">euro =</span>  fleet_data_ef_europe[shape_id <span class="sc">==</span> i]<span class="sc">$</span>euro</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">pollutant =</span> <span class="fu">c</span>(<span class="st">&quot;CO2&quot;</span>,<span class="st">&quot;NOx&quot;</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">fuel =</span>  fleet_data_ef_europe[shape_id <span class="sc">==</span> i]<span class="sc">$</span>fuel</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">tech =</span>  fleet_data_ef_europe[shape_id <span class="sc">==</span> i]<span class="sc">$</span>tech</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">as_list =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  tmp_emis <span class="ot">&lt;-</span> <span class="fu">emis</span>(<span class="at">fleet_composition =</span> fleet_data_ef_europe[shape_id <span class="sc">==</span> i]<span class="sc">$</span>fleet_composition</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">dist =</span> units<span class="sc">::</span><span class="fu">set_units</span>(linestring_poa[shape_id <span class="sc">==</span> i]<span class="sc">$</span>dist,<span class="st">&quot;km&quot;</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">ef =</span> tmp_ef_euro</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">aggregate =</span> <span class="cn">FALSE</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">as_list =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tmp_emis)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>5. Emission into grid</strong></p>
<p>We now show the example for <code>CO2</code> emissions.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Grid</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>grid_gps <span class="ot">&lt;-</span> vein<span class="sc">::</span><span class="fu">make_grid</span>(<span class="at">spobj =</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(linestring_poa<span class="sc">$</span>geometry)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">width =</span>  <span class="fl">0.25</span> <span class="sc">/</span> <span class="fl">102.47</span>) <span class="co"># 500 meters</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of lon points: 67</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of lat points: 69</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>grid_gps <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(grid_gps)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>tmp_emis_dt <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(emi_data),<span class="cf">function</span>(i){ <span class="co"># i = 3</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  tmp_emi_dt <span class="ot">&lt;-</span> <span class="fu">emi_to_dt</span>(<span class="at">emi_list =</span> emi_data[[i]]</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">emi_vars =</span> <span class="st">&quot;emi&quot;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">veh_vars =</span> <span class="st">&quot;veh_type&quot;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">pol_vars =</span> <span class="st">&quot;pollutant&quot;</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  tmp_gps <span class="ot">&lt;-</span> <span class="fu">cbind</span>(linestring_poa[shape_id <span class="sc">==</span> <span class="fu">unique</span>(gps_poa<span class="sc">$</span>shape_id)[i]]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                   ,tmp_emi_dt[pollutant <span class="sc">==</span> <span class="st">&quot;CO2&quot;</span>])</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  tmp_gps <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(tmp_gps)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  tmp_emi_grid <span class="ot">&lt;-</span> <span class="fu">emis_grid</span>(<span class="at">data =</span> tmp_gps</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">emi =</span> <span class="st">&quot;emi&quot;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                            ,<span class="at">grid =</span> grid_gps)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tmp_emi_grid)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> data.table<span class="sc">::</span><span class="fu">rbindlist</span>()</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; input data &quot;emi&quot; is in units: g</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sum of street emissions</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; emi = 26414.44 g</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sum of gridded emissions</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; emi = 26414.44 g</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; input data &quot;emi&quot; is in units: g</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sum of street emissions</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; emi = 10568.66 g</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sum of gridded emissions</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; emi = 10568.66 g</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; input data &quot;emi&quot; is in units: g</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sum of street emissions</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; emi = 20276.45 g</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sum of gridded emissions</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; emi = 20276.45 g</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; input data &quot;emi&quot; is in units: g</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sum of street emissions</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; emi = 14566 g</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sum of gridded emissions</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; emi = 14566 g</span></span></code></pre></div>
<p>Summing all emissions and plotting:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>tmp_emis_dt <span class="ot">&lt;-</span> tmp_emis_dt[,total_emi <span class="sc">:</span><span class="er">=</span> <span class="fu">sum</span>(emi), by <span class="ot">=</span> id][, .SD[<span class="dv">1</span>], by <span class="ot">=</span> id]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>tmp_emis_dt2 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(tmp_emis_dt)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tmp_emis_dt2[<span class="st">&quot;emi&quot;</span>])</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="credits" class="section level2">
<h2>Credits</h2>
<p>The gtfs2gps package is developed by a team at the Institute for Applied Economic Research (Ipea) with collaboration from the National Institute for Space Research (INPE), both from Brazil. If you have any suggestions or want to report an error, please visit the package GitHub page (add link). <!-- ## End ---- --></p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
